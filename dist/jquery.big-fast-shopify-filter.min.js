/*
 *  jquery-bigFastShopifyFilter - vv0.0.1
 *  Designed to sort and filter products using key value pairs in tags and metafields. Performs much faster on massive collections, and includes infinite scroll pagination
 *  http://colinbrogan.info/dev/big-fast-shopify-filter
 *
 *  Made by Colin Brogan
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.init()}var f="bigFastShopifyFilter",g={filter_criteria:null,collection_handle:null,paginate:20,key_value_overrides:null,metafields:null,tagfields:null,price:{enable:!0,ui_label:"Price",ui_component:"range-slider",placement:"sidebar",range_splits:4},vendor:{enable:!0,ui_component:"sidebar",placement:"sidebar",one_option_hide:!0},type:{enable:!0,ui_component:"checkbox-button-group",placement:"sidebar",one_option_hide:!0}},h=null;a.extend(e.prototype,{init:function(){if(a(this.element).data("collection")===d)return!1;this.setCollectionHandle(a(this.element).data("collection"));var b=a(this.element).find("ul.product-grid").data("fast-start");if(b!==d){var c=b;this.storeAllReceived(c)}var e=this;a(this.element).on("loadReceived",function(a,b){console.log("loadReceived"),e.storeAllReceived(b),e.filter()})},filtered:{},allReceived:{},displayEndIndex:0,collection_handle:null,filter_criteria:null,load_complete:!1,sort_property:"price",go:function(b){a(this.element).find("ul.product-grid").empty(),console.log("go fired"),console.log(this.collection_handle),this.filter_criteria=b;var c=a(this.element);if(this.filter(),this.load_complete===!1){var d=function(a){c.trigger("loadReceived",a)};Shopify.Mazer.pipeInCollection.go(this.collection_handle,d)}},filter:function(){console.log("filter fired");for(var a in this.allReceived){var b=!0;for(var c in this.filter_criteria){var d=decodeURIComponent(this.filter_criteria[c]);if(this.settings.metafields.hasOwnProperty(c))for(var e in this.allReceived[a].metafields){var f=this.allReceived[a].metafields[e];e===c&&(f===d||(b=!1))}else if(this.settings.tagfields.hasOwnProperty(c))for(var g in this.allReceived[a].info.tags){var h=this.allReceived[a].info.tags[g];if(0===h.indexOf("kvp:"+c)){var i=h.split(":"),j=i[1],k=i[2];j===c&&(d===k||(b=!1))}}}b&&(this.filtered[a]=this.allReceived[a])}console.log("filtered"),console.log(this.filtered),this.trickleToGrid()},ceaseAll:function(){},storeAllReceived:function(a){null==this.allReceived&&(this.allReceived={});for(var b in a.products)this.allReceived[b]=a.products[b]},getAllReceived:function(){return this.allReceived},trickleToGrid:function(){var b=this.collection_handle;console.log("theCollectionHandle"),console.log(b);var c=function(a){console.log("hit renderTemplate");var c={};for(var d in a.info.tags){var e=a.info.tags[d];if(0===e.indexOf("kvp:")){var f=e.split(":");c[f[1]]=f[2]}}console.log("passed tag Loop");var g="";switch(a.metafields.Condition){case"S&D":g="Scratch & Dent";break;case"NITB":g="New In Box";break;case"SO":g="Special Order";break;case"CO":g="Closeout"}return console.log("past condition switch"),["<li id='p"+a.info.id+"' class='"+a.metafields.Condition.toLowerCase().replace("&","")+"'>",'<div class="snapshot">','<a href="/collections/'+b+"/products/"+a.info.handle+'" class="product-image">','<img src="'+a.info.images[0].replace(".jpeg","_small.jpeg")+'" alt="" />',"</a>",'<dl class="specs">','<div class="spec-wrap">',"<dt>MODEL</dt>","<dd>"+a.info.handle.split("-")[0]+"</dd>","</div>",'<div class="spec-wrap">',"<dt>SERIAL</dt>","<dd>"+a.info.handle.split("-")[1]+"</dd>","</div>",'<div class="spec-wrap">',"<dt>CAPACITY</dt>","<dd>"+c["Total Capacity (cubic feet)"]+"</dd>","</div>",'<div class="spec-wrap">',"<dt>LOCATION</dt>","<dd>"+a.metafields.Location+"</dd>","</div>",'<div class="spec-wrap long">',"<dt>DIMENSIONS</dt>","<dd>"+c["Overall Width"]+'"W x '+c["Overall Height"]+'"H x '+c["Overall Depth"]+'"D</dd>',"</div>","</dl>","</div>",'<div class="price-condition">','<dl class="price">',"<dt><span hidden>Price</span></dt>","<dd>$"+a.info.price/100+"</dd>","</dl>",'<div class="count-breakout">',"<div>",'<span class="tag-count '+a.metafields.Condition.replace("&","").toLowerCase()+'">',g,"</span>","</div>","</div>","</div>",'<h4 class="product-title"><a href="/collections/'+b+"/products/"+a.info.handle+'">'+a.info.title+"</a></h4>","</li>"].join("")};console.log("this.filtered"),console.log(this.filtered);var d=this;for(var e in this.filtered)if(a("ul.product-grid li").length>0){var f=function(b){return a(this).data("json").info.id==d.filtered[e].info.id?!1:d.filtered[e].info[d.sortProperty]<a(this).data("json").info[d.sortProperty]?(a(this).before(c(d.filtered[e])).data("json",this.filtered[e]),!1):b==a("ul.product-grid li").length-1?(a(this).after(c(d.filtered[e])).data("json",this.filtered[e]),!1):void 0};a("ul.product-grid li").each(f)}else a("ul.product-grid").append(c(this.filtered[e])).data("json",this.filtered[e])},refresh:function(){console.log("refresh"),somePrivateMethod("refresh")},setSomeInfo:function(a){this.someInfo=a,console.log("Set someInfo to "+this.someInfo)},setCollectionHandle:function(a){this.collection_handle=a},getSomeInfo:function(){return this.someInfo},getPrivateInfo:function(){return h}}),a.fn[f]=function(b){var c=arguments;if(b===d||"object"==typeof b)return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))});if("string"==typeof b&&"_"!==b[0]&&"init"!==b){var g;return this.each(function(){var d=a.data(this,"plugin_"+f);d instanceof e&&"function"==typeof d[b]&&(g=d[b].apply(d,Array.prototype.slice.call(c,1))),"destroy"===b&&a.data(this,"plugin_"+f,null)}),g!==d?g:this}}}(jQuery,window,document);